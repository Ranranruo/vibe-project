<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‹¨ì–´ ë¶„ë¥˜ ë° ë§ì¶”ê¸° ê²Œì„ (JSON ì¤‘ê°„ ë‹¤ìš´ë¡œë“œ)</title>
<style>
/* í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì • */
body { 
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
display: flex; 
justify-content: center; 
align-items: center; 
min-height: 100vh;
background-color: #f4f7f9;
margin: 0; 
padding: 20px;
}

/* ê²Œì„ ì»¨í…Œì´ë„ˆ */
.game-container { 
background-color: white; 
padding: 40px; 
border-radius: 12px;
box-shadow: 0 10px 30px rgba(0,0,0,0.08);
text-align: center; 
width: 100%;
max-width: 400px;
}

/* ì œëª© */
h1 { 
color: #3b82f6;
margin-bottom: 30px; 
font-weight: 700;
}

/* í’ˆì‚¬ í‘œì‹œ */
#pos-display { 
font-size: 0.9em; 
color: #6b7280; 
margin-bottom: 10px; 
font-weight: 500;
}

/* ë¬¸ì œ ë‹¨ì–´ í‘œì‹œ */
#question-display { 
font-size: 2em; 
margin-bottom: 20px; 
min-height: 1.5em; 
color: #1f2937; 
font-weight: 700;
}

/* í‚¤ ì•ˆë‚´ */
#key-instructions { 
font-size: 0.85em; 
color: #9ca3af; 
margin-bottom: 25px;
line-height: 1.5;
padding: 10px;
border-radius: 6px;
background-color: #eff6ff;
}

/* ì…ë ¥ í•„ë“œ - ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ ìŠ¤íƒ€ì¼ì€ ìœ ì§€ */
#user-input { 
display: none; /* ì…ë ¥ í•„ë“œ ìˆ¨ê¹€ */
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
#submit-button { 
display: none; /* ì œì¶œ ë²„íŠ¼ ìˆ¨ê¹€ */
}

    /* ğŸ‘‡ğŸ‘‡ğŸ‘‡ JSON ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìˆ˜ì •ëœ ìŠ¤íƒ€ì¼ ğŸ‘‡ğŸ‘‡ğŸ‘‡ */
#download-button { 
/* ë²„íŠ¼ ìœ„ì¹˜ì™€ ìŠ¤íƒ€ì¼ì„ í•˜ë‹¨ ì ìˆ˜íŒ ê·¼ì²˜ì— ë°°ì¹˜ */
padding: 8px 15px; 
font-size: 0.9em; 
margin-top: 15px; /* ì ìˆ˜íŒ ìœ„ì— ì•½ê°„ì˜ ê³µê°„ */
margin-bottom: 10px;
cursor: pointer; 

/* í‰ì†Œì—ëŠ” ëœ ëˆˆì— ë„ê²Œ ë³€ê²½ */
background-color: #eef2ff; /* ë°ì€ ë°°ê²½ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
color: #3b82f6; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ íŒŒë€ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */
border: 1px solid #d1d5db; /* í…Œë‘ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë²„íŠ¼ì„ì„ í‘œì‹œ */

border-radius: 6px; 
transition: background-color 0.3s, box-shadow 0.3s, color 0.3s;
font-weight: 600;
display: block; /* í•­ìƒ í‘œì‹œ */
width: 90%;
max-width: 300px;
margin-left: auto;
margin-right: auto;
}
#download-button:hover:not(:disabled) { 
/* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œë§Œ ëˆˆì— ë„ê²Œ ê°•ì¡° */
background-color: #f97316; /* ëˆˆì— ë„ëŠ” ì£¼í™©ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3);
border-color: #f97316; /* í…Œë‘ë¦¬ ìƒ‰ìƒë„ ë³€ê²½ */
}
    /* ğŸ‘†ğŸ‘†ğŸ‘† JSON ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìˆ˜ì •ëœ ìŠ¤íƒ€ì¼ ğŸ‘†ğŸ‘†ğŸ‘† */


/* í”¼ë“œë°± ì˜ì—­ */
#feedback { 
margin-top: 20px; 
font-size: 1.1em; 
font-weight: bold; 
min-height: 100px;
padding: 10px;
border-radius: 8px;
background-color: #f9fafb;
display: none; 
}
.correct { color: #10b981; }
.wrong { color: #ef4444; }
.info { color: #3b82f6; }

/* ì ìˆ˜ í‘œì‹œ */
#score-display { 
margin-top: 30px; 
font-size: 0.95em; 
color: #4b5563; 
padding: 10px;
border-top: 1px solid #e5e7eb;
}

/* ì •ë‹µ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ë§ */
.answer-list { 
list-style-type: none; 
padding-left: 0; 
margin-top: 15px;
margin-bottom: 0px;
text-align: center;
}
.answer-list li {
background-color: #eef2ff;
margin: 5px;
padding: 6px 12px;
border-radius: 6px;
font-weight: 500;
color: #1e3a8a;
max-width: 90%;
font-size: 0.9em;
display: inline-block;
}
</style>
</head>
<body>

<div class="game-container">
<h1>ë‹¨ì–´ ë¶„ë¥˜ ë° ë§ì¶”ê¸°</h1>
<div id="pos-display"></div> 
<div id="question-display"></div>
<div id="key-instructions">
 **R (ë˜ëŒë¦¬ê¸°)** | **â† (ëª¨ë¥¸ë‹¤)** | **â†’ (ì•ˆë‹¤)**<br/>
 <span id="next-key-prompt" style="font-size: 0.9em; color: #f97316; font-weight: bold; display:none;">(ì•„ë¬´ í‚¤ë‚˜ ëˆŒëŸ¬ ë‹¤ìŒ ë¬¸ì œë¡œ!)</span>
</div>

 <input type="text" id="user-input" placeholder="ì •ë‹µ ì…ë ¥" style="display:none;">
<button id="submit-button" style="display:none;">ì œì¶œ</button>

<div id="feedback"></div> 

<button id="download-button">ğŸ’¾ í˜„ì¬ê¹Œì§€ ë¶„ë¥˜ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ (JSON)</button>
<div id="score-display"></div>

</div>

<script type="module">
// NOTE: ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ data.json íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
// íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨ ì‹œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
const wordList = await fetch("./data.json").then(data => data.json()).catch(err => {
 console.error("data.json íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.", err);
 return [
 ["N", "modern", "í˜„ëŒ€ì˜,ëª¨ë˜í•œ"],
 ["V", "design", "ë””ìì¸í•˜ë‹¤,ì„¤ê³„í•˜ë‹¤"],
 ["A", "sleek", "ë§¤ë„ëŸ¬ìš´,ì„¸ë ¨ëœ"],
 ["N", "container", "ì»¨í…Œì´ë„ˆ,ìš©ê¸°"],
 ["V", "optimize", "ìµœì í™”í•˜ë‹¤"],
 ];
});

let questions = [];
let currentQuestionIndex = 0;
let score = 0; 
let answeredCurrentQuestion = false;

let knownWords = [];
let unknownWords = [];

// ë¬¸ì œ ê¸°ë¡ ë°°ì—´ (ë˜ëŒë¦¬ê¸° ê¸°ëŠ¥ìš©)
let history = []; 

const questionDisplay = document.getElementById('question-display');
const posDisplay = document.getElementById('pos-display');
const userInput = document.getElementById('user-input'); 
const submitButton = document.getElementById('submit-button'); 
const feedbackDisplay = document.getElementById('feedback');
const scoreDisplay = document.getElementById('score-display');
const downloadButton = document.getElementById('download-button');
const nextKeyPrompt = document.getElementById('next-key-prompt');

function shuffleArray(array) {
 for (let i = array.length - 1; i > 0; i--) {
 const j = Math.floor(Math.random() * (i + 1)); 
 [array[i], array[j]] = [array[j], array[i]];
 }
}

function formatPOS(posString) {
 const map = {
 'N': 'ëª…ì‚¬', 'V': 'ë™ì‚¬', 'A': 'í˜•ìš©ì‚¬', 'P': 'êµ¬/í‘œí˜„', 
 'Prep': 'ì „ì¹˜ì‚¬', 'Conj': 'ì ‘ì†ì‚¬', 'Adv': 'ë¶€ì‚¬', 'Intj': 'ê°íƒ„ì‚¬'
 };
 return '[' + posString.split(',').map(p => map[p.trim()] || p.trim()).join(', ') + ']';
}

// ì •ë‹µ ëª©ë¡ì„ HTML ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
function getAnswerListHTML(question) {
 return '<ul class="answer-list">' + 
 question.correctAnswers.map(ans => `<li>${ans}</li>`).join('') +
 '</ul>';
}

// 1. ì´ˆê¸°í™”
function initializeGame() {
 wordList.forEach(item => {
 const pos = item[0];
 const english = item[1];
 const korean = item[2];
 questions.push({
 	 questionText: english,
 	 correctAnswers: korean.split(',').map(a => a.trim()),
 	 type: 'E2K',
 	 pos: pos,
 	 originalItem: item
 });
 });
 
 shuffleArray(questions);
 loadNextQuestion();
 
 // ê²Œì„ ì‹œì‘ ì‹œ ë²„íŠ¼ì„ ë³´ì´ê²Œ í•¨
 downloadButton.style.display = 'block'; 
}

// 2. ë‹¤ìŒ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
function loadNextQuestion() {
 if (currentQuestionIndex < 0) { 
 currentQuestionIndex = 0;
 }
 
 if (currentQuestionIndex < questions.length) {
 const currentQ = questions[currentQuestionIndex];
 
 questionDisplay.textContent = currentQ.questionText;
 posDisplay.textContent = formatPOS(currentQ.pos); 

 // ì¤‘ê°„ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì´ë¯€ë¡œ ë²„íŠ¼ì„ ìˆ¨ê¸°ì§€ ì•ŠìŒ
 // downloadButton.style.display = 'none'; <- ì´ ì¤„ ì œê±°

 feedbackDisplay.textContent = '';
 feedbackDisplay.className = '';
 feedbackDisplay.style.display = 'none'; // í”¼ë“œë°±/ì •ë‹µ ì˜ì—­ ìˆ¨ê¹€
 nextKeyPrompt.style.display = 'none'; // ë‹¤ìŒ ë¬¸ì œ ì•ˆë‚´ ìˆ¨ê¹€

 answeredCurrentQuestion = false;
 updateScoreDisplay();
 } else {
 endGame();
 }
}

// 4. ë‹¨ì–´ ë¶„ë¥˜ ë° ì •ë‹µ í‘œì‹œ (í™”ì‚´í‘œ í‚¤ìš©)
function classifyWord(isKnown) {
 if (answeredCurrentQuestion) return; 

 const currentQ = questions[currentQuestionIndex];
 const answerListHTML = getAnswerListHTML(currentQ);
 const classificationType = isKnown ? 'known' : 'unknown';
 
 // ë¶„ë¥˜ ë°°ì—´ì— ì¶”ê°€
 if (isKnown) {
 knownWords.push(currentQ.originalItem);
 feedbackDisplay.innerHTML = `âœ… I know<br/>${answerListHTML}`;
 feedbackDisplay.className = 'correct';
 } else {
 unknownWords.push(currentQ.originalItem);
 feedbackDisplay.innerHTML = `âŒ Stil learning <br/>${answerListHTML}`;
 	feedbackDisplay.className = 'wrong';
 }
 
 feedbackDisplay.style.display = 'block'; // ì •ë‹µ/í”¼ë“œë°± í‘œì‹œ

 // íˆìŠ¤í† ë¦¬ì— ê¸°ë¡ (ë˜ëŒë¦¬ê¸°ìš©)
 history.push({ 
 index: currentQuestionIndex, 
 classification: classificationType,
 item: currentQ.originalItem,
 timestamp: Date.now()
 });
 
 answeredCurrentQuestion = true;
 
 // ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ëŠ” ì•ˆë‚´ ë¬¸êµ¬ í‘œì‹œ
 nextKeyPrompt.style.display = 'block';
}

// 5. ì´ì „ìœ¼ë¡œ ë˜ëŒë¦¬ê¸° (R í‚¤ìš©)
function revertLastAction() {
 if (history.length === 0) {
 feedbackDisplay.textContent = "ë˜ëŒë¦´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. (R)";
 feedbackDisplay.className = 'info';
 feedbackDisplay.style.display = 'block';
 return;
 }

 const lastAction = history.pop(); 

 currentQuestionIndex = lastAction.index;
 
 const targetArray = lastAction.classification === 'known' ? knownWords : unknownWords;
 
 const itemIndex = targetArray.findIndex(item => item === lastAction.item);
 
 if (itemIndex > -1) {
 targetArray.splice(itemIndex, 1);
 }

 feedbackDisplay.textContent = `â†©ï¸ ì´ì „ ë¬¸ì œ [${lastAction.item[1]}]ë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤. (ë‚¨ì€ ë˜ëŒë¦¬ê¸°: ${history.length}íšŒ)`;
 feedbackDisplay.className = 'info';
 feedbackDisplay.style.display = 'block'; // í”¼ë“œë°± í‘œì‹œ

 loadNextQuestion();
 
 setTimeout(() => {
 feedbackDisplay.style.display = 'none';
 }, 1000);
}


// 6. ê²Œì„ ì¢…ë£Œ (ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í‘œì‹œ)
function endGame() {
 questionDisplay.textContent = "âœ… ë¶„ë¥˜ ì™„ë£Œ! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.";
 posDisplay.textContent = 'ë‹¨ì–´ ë¶„ë¥˜ ê²°ê³¼ í™•ì¸';
 
 feedbackDisplay.innerHTML = `<p class="info" style="font-size: 1.2em; margin-bottom: 10px; font-weight: 600;">ì´ ${knownWords.length + unknownWords.length}ê°œ ë‹¨ì–´ ë¶„ë¥˜ ì™„ë£Œ</p>
    <p class="correct" style="font-size: 1.1em;">**ì•ˆë‹¤** (Known): **${knownWords.length}**ê°œ</p>
    <p class="wrong" style="font-size: 1.1em;">**ëª¨ë¥¸ë‹¤** (Unknown): **${unknownWords.length}**ê°œ</p>`;
 feedbackDisplay.className = 'info';
 feedbackDisplay.style.display = 'block'; // í”¼ë“œë°±/ê²°ê³¼ í‘œì‹œ
 nextKeyPrompt.style.display = 'none'; // ë‹¤ìŒ ë¬¸ì œ ì•ˆë‚´ ìˆ¨ê¹€
 
 // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ ìµœì¢… ì™„ë£Œ ë©”ì‹œì§€ë¡œ ë³€ê²½
 downloadButton.textContent = "âœ… ìµœì¢… ë¶„ë¥˜ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ (JSON)";
 downloadButton.style.backgroundColor = '#10b981'; // ìµœì¢… ì™„ë£Œ ìƒ‰ìƒ ë³€ê²½
 
 updateScoreDisplay();
 scoreDisplay.textContent = `ì´ ë‹¨ì–´ ìˆ˜: ${questions.length} | ë¶„ë¥˜ ì™„ë£Œ: ${knownWords.length + unknownWords.length}`;
}

// 7. JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
function downloadJSON() {
 const result = {
 'knownWords': knownWords, 
 'unknownWords': unknownWords, 
 'totalWords': wordList.length,
 'choiceWords': knownWords.length + unknownWords.length, // ë¶„ë¥˜ëœ ê°œìˆ˜ ì¶”ê°€
 'ì°¸ê³ ': "ê° ë°°ì—´ì˜ í•­ëª©ì€ [í’ˆì‚¬, ì˜ì–´ ë‹¨ì–´, í•œêµ­ì–´ ëœ»] í˜•ì‹ì…ë‹ˆë‹¤. (í˜„ì¬ê¹Œì§€ ë¶„ë¥˜ëœ ë‹¨ì–´ë§Œ í¬í•¨ë©ë‹ˆë‹¤.)"
 };
 
 const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(result, null, 2));
 const downloadAnchorNode = document.createElement('a');
 downloadAnchorNode.setAttribute("href", dataStr);
 downloadAnchorNode.setAttribute("download", "ë‹¨ì–´_ë¶„ë¥˜_ì¤‘ê°„_ê²°ê³¼.json"); // íŒŒì¼ ì´ë¦„ì— 'ì¤‘ê°„' ì¶”ê°€
 document.body.appendChild(downloadAnchorNode);
 downloadAnchorNode.click();
 downloadAnchorNode.remove();
}

// 8. ì ìˆ˜íŒ ì—…ë°ì´íŠ¸ (ë³€ê²½ ì—†ìŒ)
function updateScoreDisplay() {
 if (currentQuestionIndex < questions.length) {
 scoreDisplay.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${questions.length} | ë¶„ë¥˜ ì™„ë£Œ: ${knownWords.length + unknownWords.length}`;
 }
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
downloadButton.addEventListener('click', downloadJSON);

// R í‚¤, í™”ì‚´í‘œ í‚¤, ì¼ë°˜ í‚¤ ì´ë²¤íŠ¸ (ë³€ê²½ ì—†ìŒ)
document.addEventListener('keydown', function(e) {
 const isGameActive = currentQuestionIndex < questions.length;
 
 // 1. R í‚¤ (ë˜ëŒë¦¬ê¸°)
 if (e.key === 'r' || e.key === 'R') {
 revertLastAction();
 e.preventDefault();
 }
 
 // 2. ë¶„ë¥˜ í‚¤ (í™”ì‚´í‘œ) - í˜„ì¬ ë¬¸ì œì— ì•„ì§ ë¶„ë¥˜í•˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ ì‘ë™
 else if (isGameActive && !answeredCurrentQuestion) {
 if (e.key === 'ArrowRight') {
  classifyWord(true); // ì•ˆë‹¤
  e.preventDefault();
 } else if (e.key === 'ArrowLeft') {
  classifyWord(false); // ëª¨ë¥¸ë‹¤
  e.preventDefault();
 }
 } 
 
 // 3. ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ê¸° - ë¶„ë¥˜ê°€ ì™„ë£Œë˜ì—ˆê³ (answeredCurrentQuestion = true) R, â†, â†’ í‚¤ê°€ ì•„ë‹ ë•Œ
 else if (isGameActive && answeredCurrentQuestion) {
 // ì–´ë–¤ í‚¤ë“  ëˆŒë ¸ì„ ë•Œ ë‹¤ìŒ ë¬¸ì œ ë¡œë“œ
 currentQuestionIndex++;
 loadNextQuestion();
 e.preventDefault(); 
 }
});

// ê²Œì„ ì‹œì‘
initializeGame();

</script>

</body>
</html>