<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¨ì–´ ë§ì¶”ê¸° ê²Œì„</title>
  <style>
    body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; margin: 0; }
    .game-container { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; width: 350px; }
    h1 { color: #007bff; }
    #question-display { font-size: 1.5em; margin-bottom: 5px; min-height: 1.5em; color: #333; }
    #pos-display { font-size: 0.9em; color: #888; margin-bottom: 20px; }
    #user-input { padding: 10px; font-size: 1em; width: 80%; border: 2px solid #ccc; border-radius: 5px; }
    #submit-button { padding: 10px 15px; font-size: 1em; margin-top: 10px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; transition: background-color 0.3s; }
    #submit-button:hover:not(:disabled) { background-color: #0056b3; }
    #feedback { margin-top: 15px; font-size: 1.1em; font-weight: bold; }
    .correct { color: green; }
    .wrong { color: red; }
    #score-display { margin-top: 20px; font-size: 1em; color: #555; }
        
        /* ì •ë‹µ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ë§ (ToDo List ëŠë‚Œ) */
        .answer-list { 
            list-style-type: none; /* ì  ì œê±° */
            padding-left: 0; 
            margin-top: 10px;
            margin-bottom: 5px;
            text-align: center;
        }
        .answer-list li {
            background-color: #e9ecef; /* ë°°ê²½ìƒ‰ ì¶”ê°€ */
            margin: 4px auto;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: normal;
            color: #343a40;
            max-width: 80%;
        }
  </style>
</head>
<body>

<div class="game-container">
  <h1>ë‹¨ì–´ ë§ì¶”ê¸° ê²Œì„</h1>
  <div id="pos-display"></div> 
    <div id="question-display"></div>
  <input type="text" id="user-input" placeholder="ì •ë‹µ ì…ë ¥">
  <button id="submit-button">ì œì¶œ</button>
  <div id="feedback"></div>
  <div id="score-display"></div>
</div>

<script type="module">
  // NOTE: ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ data2115.json íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
    // data2115.json íŒŒì¼ ì˜ˆì‹œ: [["N", "apple", "ì‚¬ê³¼"], ["V", "run", "ë‹¬ë¦¬ë‹¤, ë›°ë‹¤"], ["A", "happy", "í–‰ë³µí•œ,ê¸°ìœ"]]
  const wordList = await fetch("./data.json").then(data => data.json()).catch(err => {
    console.error("data2115.json íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.", err);
    // íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨ ì‹œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì—¬ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
    return [
      ["N", "example", "ì˜ˆì œ,ìƒ˜í”Œ"],
      ["V", "test", "í…ŒìŠ¤íŠ¸í•˜ë‹¤,ì‹œí—˜í•˜ë‹¤"],
      ["A", "complete", "ì™„ì „í•œ,ë§ˆì¹˜ë‹¤"]
    ];
  });

  let questions = [];
  let currentQuestionIndex = 0;
  let score = 0;
  let answeredCurrentQuestion = false;

  const questionDisplay = document.getElementById('question-display');
  const posDisplay = document.getElementById('pos-display');
  const userInput = document.getElementById('user-input');
  const submitButton = document.getElementById('submit-button');
  const feedbackDisplay = document.getElementById('feedback');
  const scoreDisplay = document.getElementById('score-display');

  // Fisher-Yates ì…”í”Œ ì•Œê³ ë¦¬ì¦˜: ë°°ì—´ì„ ë¬´ì‘ìœ„ë¡œ ì„ìŠµë‹ˆë‹¤.
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1)); 
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  // í’ˆì‚¬ ì•½ì–´ë¥¼ í•œêµ­ì–´ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
  function formatPOS(posString) {
    const map = {
      'N': 'ëª…ì‚¬',
      'V': 'ë™ì‚¬',
      'A': 'í˜•ìš©ì‚¬',
      'P': 'êµ¬/í‘œí˜„',
      'Prep': 'ì „ì¹˜ì‚¬',
      'Conj': 'ì ‘ì†ì‚¬',
      'Adv': 'ë¶€ì‚¬',
      'Intj': 'ê°íƒ„ì‚¬'
    };
    return '[' + posString.split(',').map(p => map[p.trim()] || p.trim()).join(', ') + ']';
  }

  // 1. ì´ˆê¸°í™”: ëª¨ë“  ë‹¨ì–´ë¥¼ ì˜->í•œ ë¬¸ì œë¡œ ìƒì„± ë° ì„ê¸°
  function initializeGame() {
    wordList.forEach(item => {
      const pos = item[0];
      const english = item[1];
      const korean = item[2];

      // ì˜ì–´ë¥¼ ë³´ì—¬ì£¼ê³  í•œêµ­ì–´ ë‹µì„ ë§ì¶”ëŠ” ë¬¸ì œ (E2K)
      questions.push({
        questionText: english,
        correctAnswers: korean.split(',').map(a => a.trim()), // ê³µë°± ì œê±° í›„ ë°°ì—´ì— ì €ì¥
        type: 'E2K',
        pos: pos
      });
    });
    
    shuffleArray(questions);
    
    loadNextQuestion();
  }

  // 2. ë‹¤ìŒ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
  function loadNextQuestion() {
    if (currentQuestionIndex < questions.length) {
      const currentQ = questions[currentQuestionIndex];
      
      questionDisplay.textContent = currentQ.questionText;
      posDisplay.textContent = formatPOS(currentQ.pos); 

      userInput.value = '';
      userInput.disabled = false;
      userInput.focus();
      feedbackDisplay.textContent = '';
      submitButton.textContent = 'ì œì¶œ';
      submitButton.disabled = false;
      answeredCurrentQuestion = false;
      updateScoreDisplay();
    } else {
      endGame();
    }
  }

  // 3. ì •ë‹µ í™•ì¸ ë° ë‹¤ìŒ ë‹¨ê³„ íŠ¸ë¦¬ê±°
  function handleAction() {
    if (answeredCurrentQuestion) {
      currentQuestionIndex++;
      loadNextQuestion();
    } else {
      checkAnswer();
    }
  }

  function checkAnswer() {
    const userAnswerProcessed = userInput.value.trim().toLowerCase().replace(/\s/g, '');
    const currentQ = questions[currentQuestionIndex];
    
    // ì •ë‹µ ëª©ë¡ì˜ ê° í•­ëª©ì„ ì†Œë¬¸ì/ê³µë°± ì œê±° í›„ ë¹„êµ
    const isCorrect = currentQ.correctAnswers.some(answer => 
      answer.toLowerCase().replace(/\s/g, '') === userAnswerProcessed
    );

    // ì •ë‹µ ëª©ë¡ì„ ê¹”ë”í•œ HTML ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ë§Œë“­ë‹ˆë‹¤.
    const answerListHTML = 
      '<ul class="answer-list">' + 
      currentQ.correctAnswers.map(ans => `<li>${ans}</li>`).join('') +
      '</ul>';

    // ì§§ì€ í”¼ë“œë°±ê³¼ ì •ë‹µ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥
    if (isCorrect) {
      feedbackDisplay.innerHTML = `ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰<br/>${answerListHTML}`;
      feedbackDisplay.className = 'correct';
      score++;
    } else {
      feedbackDisplay.innerHTML = `ì˜¤ë‹µì…ë‹ˆë‹¤. ğŸ˜<br/>${answerListHTML}`;
      feedbackDisplay.className = 'wrong';
    }
    
    feedbackDisplay.innerHTML += '<span style="font-weight: normal; display: block; margin-top: 5px;">(Enter/í´ë¦­ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ)</span>';
    
    answeredCurrentQuestion = true;
    submitButton.textContent = 'ë‹¤ìŒ ë¬¸ì œ';
    userInput.disabled = true; // ì •ë‹µ í™•ì¸ í›„ ì…ë ¥ ë¹„í™œì„±í™”
    submitButton.focus(); // ë²„íŠ¼ì— í¬ì»¤ìŠ¤ ì´ë™
  }

  // 4. ê²Œì„ ì¢…ë£Œ
  function endGame() {
    questionDisplay.textContent = "ê²Œì„ ì¢…ë£Œ! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.";
    posDisplay.textContent = '';
    feedbackDisplay.textContent = `ìµœì¢… ì ìˆ˜: ${score} / ${questions.length}`;
    submitButton.disabled = true;
    userInput.disabled = true;
    scoreDisplay.textContent = `ìµœì¢… ì ìˆ˜: ${score} / ${questions.length}`;
  }

  // 5. ì ìˆ˜íŒ ì—…ë°ì´íŠ¸
  function updateScoreDisplay() {
    scoreDisplay.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${questions.length} | ì ìˆ˜: ${score}`;
  }

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  submitButton.addEventListener('click', handleAction);
  userInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      // ì…ë ¥ì´ ë¹„í™œì„±í™”ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ ì‘ë™
      if (userInput.disabled === false || answeredCurrentQuestion) {
        handleAction();
      }
    }
  });

  // ê²Œì„ ì‹œì‘
  initializeGame();

</script>

</body>
</html>