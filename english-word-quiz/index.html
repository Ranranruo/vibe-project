<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¨ì–´ ë§ì¶”ê¸° ê²Œì„</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; margin: 0; }
        .game-container { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; width: 350px; }
        #question-display { font-size: 1.5em; margin-bottom: 5px; min-height: 1.5em; color: #333; }
        #pos-display { font-size: 0.9em; color: #888; margin-bottom: 20px; }
        #user-input { padding: 10px; font-size: 1em; width: 80%; border: 2px solid #ccc; border-radius: 5px; }
        #submit-button { padding: 10px 15px; font-size: 1em; margin-top: 10px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px; }
        #feedback { margin-top: 15px; font-size: 1.1em; font-weight: bold; }
        .correct { color: green; }
        .wrong { color: red; }
        #score-display { margin-top: 20px; font-size: 1em; color: #555; }
    </style>
</head>
<body>

<div class="game-container">
    <h1>ë‹¨ì–´ ë§ì¶”ê¸° ê²Œì„</h1>
    <div id="pos-display"></div> <!-- í’ˆì‚¬ í‘œì‹œ ì˜ì—­ -->
    <div id="question-display"></div>
    <input type="text" id="user-input" placeholder="ì •ë‹µ ì…ë ¥">
    <button id="submit-button">ì œì¶œ</button>
    <div id="feedback"></div>
    <div id="score-display"></div>
</div>

<script type="module">
    // NOTE: ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ a.json íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
    const wordList = await fetch("./data.json").then(data => data.json()).catch(err => {
        console.error("data.json íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.", err);
        return [
            ["Error", "JSON íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”", "ì˜¤ë¥˜"]
        ];
    });

    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let answeredCurrentQuestion = false;

    const questionDisplay = document.getElementById('question-display');
    const posDisplay = document.getElementById('pos-display');
    const userInput = document.getElementById('user-input');
    const submitButton = document.getElementById('submit-button');
    const feedbackDisplay = document.getElementById('feedback');
    const scoreDisplay = document.getElementById('score-display');

    // í’ˆì‚¬ ì•½ì–´ë¥¼ í•œêµ­ì–´ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
    function formatPOS(posString) {
        const map = {
            'N': 'ëª…ì‚¬',
            'V': 'ë™ì‚¬',
            'A': 'í˜•ìš©ì‚¬',
            'P': 'êµ¬/í‘œí˜„',
            'Prep': 'ì „ì¹˜ì‚¬',
            'Conj': 'ì ‘ì†ì‚¬',
            'Adv': 'ë¶€ì‚¬',
            'Intj': 'ê°íƒ„ì‚¬'
        };
        return '[' + posString.split(',').map(p => map[p.trim()] || p.trim()).join(', ') + ']';
    }

    // 1. ì´ˆê¸°í™”: ëª¨ë“  ë‹¨ì–´ë¥¼ ì˜->í•œ, í•œ->ì˜ ë‘ ê°€ì§€ ëª¨ë“œë¡œ ë¬¸ì œ ìƒì„±
    function initializeGame() {
        wordList.forEach(item => {
            const pos = item[0];
            const english = item[1];
            const korean = item[2];

            // ì˜ì–´ë¥¼ ë³´ì—¬ì£¼ê³  í•œêµ­ì–´ ë‹µì„ ë§ì¶”ëŠ” ë¬¸ì œ
            questions.push({
                questionText: english,
                correctAnswers: korean.split(','),
                type: 'E2K',
                pos: pos
            });

            // í•œêµ­ì–´ë¥¼ ë³´ì—¬ì£¼ê³  ì˜ì–´ ë‹µì„ ë§ì¶”ëŠ” ë¬¸ì œ
            questions.push({
                questionText: korean,
                correctAnswers: [english],
                type: 'K2E',
                pos: pos
            });
        });
        questions = questions.sort(() => Math.random() - 0.5);
        loadNextQuestion();
    }

    // 2. ë‹¤ìŒ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadNextQuestion() {
        if (currentQuestionIndex < questions.length) {
            const currentQ = questions[currentQuestionIndex];
            
            questionDisplay.textContent = currentQ.questionText;
            posDisplay.textContent = formatPOS(currentQ.pos); 

            userInput.value = '';
            userInput.focus();
            feedbackDisplay.textContent = '';
            submitButton.textContent = 'ì œì¶œ';
            answeredCurrentQuestion = false;
            updateScoreDisplay();
        } else {
            endGame();
        }
    }

    // 3. ì •ë‹µ í™•ì¸ ë° ë‹¤ìŒ ë‹¨ê³„ íŠ¸ë¦¬ê±°
    function handleAction() {
        if (answeredCurrentQuestion) {
            currentQuestionIndex++;
            loadNextQuestion();
        } else {
            checkAnswer();
        }
    }

    function checkAnswer() {
        // ì‚¬ìš©ìì˜ ì…ë ¥ì—ì„œ ê³µë°± ì œê±° ë° ì†Œë¬¸ì ë³€í™˜
        const userAnswerProcessed = userInput.value.trim().toLowerCase().replace(/\s/g, '');
        const currentQ = questions[currentQuestionIndex];
        
        // ì •ë‹µ ëª©ë¡ì˜ ê° í•­ëª©ì—ì„œë„ ê³µë°± ì œê±° ë° ì†Œë¬¸ì ë³€í™˜ í›„ ë¹„êµ
        const isCorrect = currentQ.correctAnswers.some(answer => 
            answer.trim().toLowerCase().replace(/\s/g, '') === userAnswerProcessed
        );

        if (isCorrect) {
            feedbackDisplay.textContent = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰ (Enter/í´ë¦­ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ)";
            feedbackDisplay.className = 'correct';
            score++;
        } else {
            feedbackDisplay.textContent = `ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ '${currentQ.correctAnswers.join(', ')}'ì…ë‹ˆë‹¤. (Enter/í´ë¦­ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œ)`;
            feedbackDisplay.className = 'wrong';
        }
        
        answeredCurrentQuestion = true;
        submitButton.textContent = 'ë‹¤ìŒ ë¬¸ì œ';
        userInput.focus();
    }

    // 4. ê²Œì„ ì¢…ë£Œ
    function endGame() {
        questionDisplay.textContent = "ê²Œì„ ì¢…ë£Œ! ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.";
        posDisplay.textContent = '';
        feedbackDisplay.textContent = `ìµœì¢… ì ìˆ˜: ${score} / ${questions.length}`;
        submitButton.disabled = true;
        userInput.disabled = true;
    }

    // 5. ì ìˆ˜íŒ ì—…ë°ì´íŠ¸
    function updateScoreDisplay() {
        scoreDisplay.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${questions.length} | ì ìˆ˜: ${score}`;
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    submitButton.addEventListener('click', handleAction);
    userInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            handleAction();
        }
    });

    // ê²Œì„ ì‹œì‘
    initializeGame();

</script>

</body>
</html>
